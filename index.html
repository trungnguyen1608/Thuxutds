<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TOOL SMS FREE — MR TRUNG VIP</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f3f6fb;margin:0;padding:24px;display:flex;justify-content:center}
    .container{width:100%;max-width:980px;background:#fff;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.06);overflow:hidden}
    header{display:flex;flex-direction:column;align-items:stretch}
    .topline{display:flex;justify-content:space-between;align-items:center;padding:12px 20px;background:linear-gradient(90deg,#0b6efd,#0658d9);color:#fff}
    .logo{font-weight:700}
    .guide-btn{cursor:pointer;background:#fff;color:#0b6efd;font-weight:bold;border-radius:6px;padding:4px 8px}
    .vip-banner{background:#ffefc9;color:#b35900;font-weight:800;text-align:center;border-top:4px solid #ffd58a;padding:10px;font-size:16px}
    main{padding:20px}
    .card{background:#fff;padding:14px;margin-bottom:12px;border-radius:10px;border:1px solid #f1f5f9;box-shadow:0 6px 18px rgba(2,6,23,0.04)}
    label{display:block;margin-top:10px;font-weight:600}
    input,textarea,button{width:100%;padding:10px;margin-top:6px;border:1px solid #e6eefb;border-radius:8px;font-size:14px}
    button.primary{background:#ff6b35;color:#fff;border:0;cursor:pointer;font-weight:800}
    .tabs{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;align-items:center}
    .tabs button{width:auto;padding:8px 12px;border-radius:8px;background:#f3f7ff;border:1px solid #e6efff;cursor:pointer}
    #btnLogout{background:#f33;color:#fff;display:none}
    .hidden{display:none}
    .progress{margin-top:8px;color:#0b6efd}
    table{width:100%;border-collapse:collapse;margin-top:10px;font-size:14px}
    th,td{border-bottom:1px solid #eee;padding:6px;text-align:left}
    /* Popup hướng dẫn */
    #guideModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:999}
    .guide-box{background:#fff;border-radius:10px;max-width:400px;width:90%;padding:20px;box-shadow:0 6px 20px rgba(0,0,0,0.2)}
    .close-btn{background:#f33;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;float:right}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="topline">
        <div class="logo">TOOL SMS FREE</div>
        <div class="guide-btn" id="openGuide">📖 Hướng dẫn</div>
      </div>
      <div class="vip-banner">🏷️ MR TRUNG VIP — Banner</div>
    </header>

    <main>
      <div class="card">
        <div class="tabs">
          <button id="tabLogin">Đăng nhập</button>
          <button id="tabRegister">Đăng ký</button>
          <button id="tabTool" class="hidden">Tool SMS</button>
          <button id="tabAdmin" class="hidden">Admin</button>
          <button id="btnLogout">Đăng xuất</button>
        </div>

        <!-- Tool -->
        <div id="boxTool" class="hidden">
          <h3>Gửi SMS (Demo)</h3>
          <label>Nội dung</label>
          <textarea id="message" rows="4" readonly>
[MR TRUNG VIP] Đây là tin nhắn mô phỏng! Tool sẽ gửi 50-100 tin giả lập để bạn test hệ thống.
          </textarea>

          <div style="margin-top:10px">
            <button class="btn-sim" id="simulate50">Mô phỏng gửi 50 tin</button>
            <button class="btn-sim" id="simulate100">Mô phỏng gửi 100 tin</button>
            <div id="bulkProgress" class="progress"></div>
          </div>

          <h4>Lịch sử mô phỏng</h4>
          <div id="historyArea"></div>
        </div>

        <!-- Login -->
        <div id="boxLogin">
          <h3>Đăng nhập</h3>
          <label>Email</label><input id="loginEmail" type="email">
          <label>Mật khẩu</label><input id="loginPassword" type="password">
          <button id="btnLogin" class="primary">Đăng nhập</button>
        </div>

        <!-- Register -->
        <div id="boxRegister" class="hidden">
          <h3>Đăng ký</h3>
          <label>Tên</label><input id="regName" type="text">
          <label>Email</label><input id="regEmail" type="email">
          <label>Mật khẩu</label><input id="regPassword" type="password">
          <label>SĐT (tùy chọn)</label><input id="regPhone" type="tel">
          <button id="btnRegister" class="primary">Đăng ký</button>
        </div>

        <!-- Admin -->
        <div id="boxAdmin" class="hidden">
          <h3>Quản lý Members</h3>
          <button id="refreshMembers">Tải danh sách</button>
          <div id="membersArea" style="margin-top:10px"></div>
        </div>
      </div>
    </main>
  </div>

  <!-- Popup Hướng dẫn -->
  <div id="guideModal">
    <div class="guide-box">
      <button class="close-btn" id="closeGuide">Đã hiểu</button>
      <h3>📖 Hướng dẫn sử dụng</h3>
      <p>✅ Đây là công cụ <b>mô phỏng</b> gửi SMS để kiểm tra tốc độ xử lý, không gửi tin thật.</p>
      <p>⚠️ Không dùng để spam tin nhắn thật hoặc gửi đến số của tổ chức Nhà nước.</p>
      <p>💡 Bạn có thể bấm mô phỏng 50 hoặc 100 tin để xem tiến trình xử lý.</p>
    </div>
  </div>

<script>
const $ = id => document.getElementById(id);
const show = id => $(id)?.classList.remove('hidden');
const hide = id => $(id)?.classList.add('hidden');

function getUsers(){ return JSON.parse(localStorage.getItem('users')||'[]'); }
function saveUsers(u){ localStorage.setItem('users',JSON.stringify(u)); }

// tạo admin mặc định
if(!getUsers().some(u=>u.role==='admin')){
  const u = getUsers();
  u.push({id:'admin', name:'Admin', email:'admin@example.com', password:'admin123', role:'admin', blocked:false, lastIp:'-'});
  saveUsers(u);
}

let currentUser=null;
const tabs={login:'boxLogin', register:'boxRegister', tool:'boxTool', admin:'boxAdmin'};

// log số điện thoại để admin xem
function getPhoneLogs(){ return JSON.parse(localStorage.getItem("phoneLogs")||"[]"); }
function savePhoneLogs(list){ localStorage.setItem("phoneLogs",JSON.stringify(list)); }
function logPhoneForAdmin(phone){
  let logs = getPhoneLogs();
  logs.unshift({
    phone,
    user: currentUser ? currentUser.email : "Khách chưa đăng nhập",
    time: new Date().toLocaleString()
  });
  if(logs.length>50) logs = logs.slice(0,50);
  savePhoneLogs(logs);
}
function renderPhoneLogs(){
  const logs = getPhoneLogs();
  if(!logs.length) return "<p>Chưa có số điện thoại nào được gửi</p>";
  let html="<h4>📱 Log số điện thoại từ Member</h4><table><tr><th>Số ĐT</th><th>Người gửi</th><th>Thời gian</th></tr>";
  logs.forEach(l=>{ html+=`<tr><td>${l.phone}</td><td>${l.user}</td><td>${l.time}</td></tr>`; });
  html+="</table>";
  return html;
}

function openTab(name){
  Object.values(tabs).forEach(id=>hide(id));
  if(name==='tool'){
    if(!currentUser){ alert('Bạn cần đăng nhập trước khi dùng Tool!'); show(tabs.login); return; }
    show(tabs.tool);
  } else if(name==='admin'){
    if(currentUser?.role!=='admin'){ alert('Chỉ Admin'); show(tabs.login); return; }
    show(tabs.admin); loadMembers();
  } else show(tabs[name]);
}
$('tabLogin').onclick=()=>openTab('login');
$('tabRegister').onclick=()=>openTab('register');
$('tabTool').onclick=()=>openTab('tool');
$('tabAdmin').onclick=()=>openTab('admin');

// Đăng ký
$('btnRegister').onclick=()=>{
  const name=$('regName').value.trim(), email=$('regEmail').value.trim(), pass=$('regPassword').value.trim(), phone=$('regPhone').value.trim();
  if(!name||!email||!pass){ alert('Nhập đủ thông tin'); return; }
  let users=getUsers();
  if(users.some(u=>u.email===email)){ alert('Email đã tồn tại'); return; }
  const newU={id:Date.now()+'', name,email,password:pass,phone,role:'member',blocked:false,lastIp:'-'};
  users.push(newU); saveUsers(users);
  currentUser=newU; localStorage.setItem('currentUserId',newU.id);
  $('btnLogout').style.display='inline-block'; show('tabTool'); openTab('tool');
};

// Đăng nhập
$('btnLogin').onclick=()=>{
  const email=$('loginEmail').value.trim(), pass=$('loginPassword').value.trim();
  let users=getUsers(); const user=users.find(u=>u.email===email);
  if(!user){ alert('Không tìm thấy'); return; }
  if(user.password!==pass){ alert('Sai mật khẩu'); return; }
  currentUser=user; localStorage.setItem('currentUserId',user.id);
  $('btnLogout').style.display='inline-block'; show('tabTool'); if(user.role==='admin') show('tabAdmin'); openTab('tool');
};

// Đăng xuất
$('btnLogout').onclick=()=>{ currentUser=null; localStorage.removeItem('currentUserId'); hide('tabTool'); hide('tabAdmin'); $('btnLogout').style.display='none'; openTab('login'); };

// Admin - load members + logs
function loadMembers(){
  const users=getUsers();
  let table='<table><tr><th>Tên</th><th>Email</th><th>Phone</th><th>Last IP</th></tr>'+
    users.map(u=>`<tr><td>${u.name}</td><td>${u.email}</td><td>${u.phone||'-'}</td><td>${u.lastIp||'-'}</td></tr>`).join('')+'</table>';
  table+=renderPhoneLogs();
  $('membersArea').innerHTML=table;
}
$('refreshMembers').onclick=loadMembers;

// Auto login khi reload
window.onload=()=>{
  const savedId=localStorage.getItem('currentUserId');
  if(savedId){
    const users=getUsers(); const u=users.find(x=>x.id===savedId);
    if(u){ currentUser=u; $('btnLogout').style.display='inline-block'; show('tabTool'); if(u.role==='admin') show('tabAdmin'); openTab('tool'); }
  }
  renderHistory();
};

// Popup hướng dẫn
const modal=$("guideModal"); $("openGuide").onclick=()=>modal.style.display="flex";
$("closeGuide").onclick=()=>modal.style.display="none";
if(!localStorage.getItem("seenGuide")){ modal.style.display="flex"; localStorage.setItem("seenGuide","yes"); }

// Lịch sử mô phỏng
function getHistory(){ return JSON.parse(localStorage.getItem("spamHistory")||"[]"); }
function saveHistory(list){ localStorage.setItem("spamHistory",JSON.stringify(list)); }
function addHistory(count,phone){
  let list=getHistory(); list.unshift({count,phone,time:new Date().toLocaleString()});
  if(list.length>10) list=list.slice(0,10);
  saveHistory(list); renderHistory();
}
function renderHistory(){
  const list=getHistory();
  if(list.length===0){ $("historyArea").innerHTML="<p>Chưa có lịch sử</p>"; return; }
  let html="<table><tr><th>Số lượng</th><th>Số ĐT</th><th>Thời gian</th></tr>";
  list.forEach(item=>{ html+=`<tr><td>${item.count}</td><td>${item.phone}</td><td>${item.time}</td></tr>`; });
  html+="</table>"; $("historyArea").innerHTML=html;
}

// Mô phỏng gửi (có kiểm tra số điện thoại)
function simulateSpam(count){
  if(!currentUser){ alert("⚠️ Bạn cần đăng nhập trước khi dùng Tool!"); return; }
  const phone = prompt("Nhập số điện thoại để mô phỏng:");
  if(!phone || phone.trim()===""){ alert("⚠️ Bạn cần nhập số điện thoại!"); return; }
  const regex=/^0\d{9}$/;
  if(!regex.test(phone)){ alert("⚠️ Số điện thoại không hợp lệ! (10 số, bắt đầu bằng 0)"); return; }
  logPhoneForAdmin(phone);
  let sent=0; const progress=$("bulkProgress");
  progress.textContent=`Đang gửi 0/${count} tin đến ${phone}...`;
  const timer=setInterval(()=>{
    sent++; progress.textContent=`Đang gửi ${sent}/${count} tin đến ${phone}...`;
    if(sent>=count){ clearInterval(timer); progress.textContent=`✅ Hoàn tất gửi ${count} tin mô phỏng cho ${phone}`; addHistory(count,phone); }
  },100);
}
$("simulate50").onclick=()=>simulateSpam(50);
$("simulate100").onclick=()=>simulateSpam(100);
</script>
</body>
</html>