<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TOOL SMS FREE — Demo</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f3f6fb;margin:0;padding:24px;display:flex;justify-content:center}
    .container{width:100%;max-width:980px;background:#fff;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.06);overflow:hidden}
    header{display:flex;justify-content:space-between;align-items:center;padding:14px 20px;background:linear-gradient(90deg,#0b6efd,#0658d9);color:#fff}
    header .logo{font-weight:700}
    main{padding:20px}
    .card{background:#fff;padding:14px;margin-bottom:12px;border-radius:10px;border:1px solid #f1f5f9;box-shadow:0 6px 18px rgba(2,6,23,0.04)}
    label{display:block;margin-top:10px;font-weight:600}
    input,textarea,button{width:100%;padding:10px;margin-top:6px;border:1px solid #e6eefb;border-radius:8px;font-size:14px}
    button.primary{background:#ff6b35;color:#fff;border:0;cursor:pointer;font-weight:800}
    button[disabled]{background:#ccc;cursor:not-allowed}
    .tabs{display:flex;gap:8px;margin-bottom:12px}
    .tabs button{width:auto;padding:8px 12px;border-radius:8px;background:#f3f7ff;border:1px solid #e6efff;cursor:pointer}
    .hidden{display:none}
    .small{font-size:13px;color:#6b7280;margin-top:8px}
    .alert{color:red;font-weight:bold;margin-top:8px}
    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #fff;
      border-radius: 50%;
      width: 14px;
      height: 14px;
      animation: spin 1s linear infinite;
      display: inline-block;
      vertical-align: middle;
      margin-right: 6px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    #toolCountdown {
      font-size: 22px;
      font-weight: bold;
      color: #ff6b35;
      margin-top: 10px;
      letter-spacing: 2px;
      font-family: 'Courier New', monospace;
      background: #fff3e6;
      padding: 8px 12px;
      border-radius: 8px;
      display: inline-block;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">TOOL SMS FREE — Zalo Admin: <strong>0869234153</strong></div>
      <button id="btnLogout" class="hidden" style="background:#fff;color:#0b6efd;border:0;padding:6px 12px;border-radius:6px;cursor:pointer">Đăng xuất</button>
    </header>

    <main>
      <div class="card">
        <div class="tabs">
          <button id="tabLogin">Đăng nhập</button>
          <button id="tabRegister">Đăng ký</button>
          <button id="tabTool" class="hidden">Tool SMS</button>
          <button id="tabAdmin" class="hidden">Admin</button>
        </div>

        <!-- Tool -->
        <div id="boxTool" class="hidden">
          <h3>Gửi SMS (Demo)</h3>
          <label>Số điện thoại</label><input id="phone" type="tel" placeholder="0899...">
          <label>Nội dung</label><textarea id="message" rows="4"></textarea>
          <div style="display:flex;gap:8px;margin-top:10px">
            <button id="sendDemo" class="primary" style="flex:1">Gửi (Demo)</button>
            <button id="showPhone" style="flex:1">Gọi / Hiện số</button>
          </div>
          <div id="toolMsg" class="small"></div>
          <div id="toolAlert" class="alert hidden">⏰ Tool chỉ hoạt động từ 19h–24h</div>
          <div style="margin-top:10px">
            <div id="toolCountdown"></div>
            <div id="toolNote" class="small" style="color:#6b7280;margin-top:4px"></div>
          </div>
        </div>

        <!-- Login -->
        <div id="boxLogin">
          <h3>Đăng nhập</h3>
          <label>Email</label><input id="loginEmail" type="email">
          <label>Mật khẩu</label><input id="loginPassword" type="password">
          <button id="btnLogin" class="primary">Đăng nhập</button>
          <div id="loginMsg" class="small"></div>
        </div>

        <!-- Register -->
        <div id="boxRegister" class="hidden">
          <h3>Đăng ký</h3>
          <label>Tên</label><input id="regName" type="text">
          <label>Email</label><input id="regEmail" type="email">
          <label>Mật khẩu</label><input id="regPassword" type="password">
          <button id="btnRegister" class="primary">Đăng ký</button>
          <div id="regMsg" class="small"></div>
        </div>

        <!-- Admin -->
        <div id="boxAdmin" class="hidden">
          <h3>Quản lý Members</h3>
          <button id="refreshMembers">Tải danh sách</button>
          <div id="membersArea" style="margin-top:10px"></div>
        </div>
      </div>
    </main>
  </div>

<script>
  const $ = id => document.getElementById(id);
  const show = id => $(id).classList.remove('hidden');
  const hide = id => $(id).classList.add('hidden');
  const setMsg = (id,txt,color) => { const el=$(id); el.textContent=txt; el.style.color=color||'black'; };

  // Fake DB
  function getUsers(){ return JSON.parse(localStorage.getItem('users')||'[]'); }
  function saveUsers(u){ localStorage.setItem('users',JSON.stringify(u)); }

  // Admin default
  if(!getUsers().some(u=>u.role==='admin')){
    let u=getUsers();
    u.push({id:'admin',name:'Admin',email:'admin@example.com',password:'admin123',role:'admin',blocked:false});
    saveUsers(u);
  }

  let currentUser=null;

  // Hàm cập nhật trạng thái Tool theo giờ
  function updateToolStatus(){
    const now = new Date();
    const hour = now.getHours();

    if(hour < 19){ 
      const target = new Date();
      target.setHours(19,0,0,0);
      show('toolAlert'); 
      $('sendDemo').setAttribute('disabled','true');
      updateCountdown(target - now);
      $('toolNote').textContent = "Tool sẽ mở vào lúc 19h hôm nay";
    } else if(hour >= 24){ 
      const target = new Date();
      target.setDate(target.getDate()+1);
      target.setHours(19,0,0,0);
      show('toolAlert'); 
      $('sendDemo').setAttribute('disabled','true');
      updateCountdown(target - now);
      $('toolNote').textContent = "Tool sẽ mở vào lúc 19h ngày mai";
    } else {
      hide('toolAlert'); 
      $('sendDemo').removeAttribute('disabled');
      $('toolCountdown').textContent = '';
      $('toolNote').textContent = '';
    }
  }

  function updateCountdown(ms){
    const totalSec = Math.max(0, Math.floor(ms/1000));
    const h = String(Math.floor(totalSec/3600)).padStart(2,'0');
    const m = String(Math.floor((totalSec%3600)/60)).padStart(2,'0');
    const s = String(totalSec%60).padStart(2,'0');
    $('toolCountdown').textContent = `⏳ ${h}:${m}:${s}`;
  }

  // Tabs
  const tabs={login:'boxLogin',register:'boxRegister',tool:'boxTool',admin:'boxAdmin'};
  function openTab(name){
    Object.values(tabs).forEach(id=>hide(id));
    if(name==='tool'){
      if(!currentUser){ alert('Bạn cần đăng nhập'); show(tabs.login); return; }
      show(tabs.tool);
      updateToolStatus(); // kiểm tra ngay khi mở Tool
    } else if(name==='admin'){
      if(currentUser?.role!=='admin'){ alert('Chỉ Admin'); show(tabs.login); return; }
      show(tabs.admin); loadMembers();
    } else { show(tabs[name]); }
  }
  $('tabLogin').onclick=()=>openTab('login');
  $('tabRegister').onclick=()=>openTab('register');
  $('tabTool').onclick=()=>openTab('tool');
  $('tabAdmin').onclick=()=>openTab('admin');
  openTab('login');

  // Đăng ký
  $('btnRegister').onclick=()=>{
    const name=$('regName').value.trim();
    const email=$('regEmail').value.trim();
    const pass=$('regPassword').value.trim();
    if(!name||!email||!pass){ setMsg('regMsg','Nhập đủ thông tin','red'); return; }
    let users=getUsers();
    if(users.some(u=>u.email===email)){ setMsg('regMsg','Email đã tồn tại','red'); return; }
    const newU={id:Date.now()+'',name,email,password:pass,role:'member',blocked:false};
    users.push(newU); saveUsers(users);
    currentUser=newU;
    setMsg('regMsg','Đăng ký thành công','green');
    show('tabTool'); show('btnLogout'); if(newU.role==='admin') show('tabAdmin');
    openTab('tool');
  };

  // Đăng nhập
  $('btnLogin').onclick=()=>{
    const email=$('loginEmail').value.trim();
    const pass=$('loginPassword').value.trim();
    let users=getUsers();
    const user=users.find(u=>u.email===email);
    if(!user){ setMsg('loginMsg','Không tìm thấy','red'); return; }
    if(user.blocked){ setMsg('loginMsg','Tài khoản bị chặn','red'); return; }
    if(user.password!==pass){ setMsg('loginMsg','Sai mật khẩu','red'); return; }
    currentUser=user;
    setMsg('loginMsg','Đăng nhập thành công','green');
    show('tabTool'); show('btnLogout'); if(user.role==='admin') show('tabAdmin');
    openTab('tool');
  };

  // Đăng xuất
  $('btnLogout').onclick=()=>{
    currentUser=null; hide('tabTool'); hide('tabAdmin'); hide('btnLogout'); openTab('login');
  };

  // Tool demo với hiệu ứng loading spinner
  $('sendDemo').onclick=()=>{
    const phone=$('phone').value.trim(); 
    const msg=$('message').value.trim();
    if(!phone||!msg){ setMsg('toolMsg','Nhập phone & nội dung','red'); return; }

    const btn = $('sendDemo');
    btn.innerHTML = '<span class="loading-spinner"></span>Đang gửi...';
    btn.setAttribute('disabled','true');
    setMsg('toolMsg','Đang xử lý...','blue');

    setTimeout(()=>{
      btn.textContent = "Gửi (Demo)";
      updateToolStatus(); // sau khi gửi xong, kiểm tra giờ
      setMsg('toolMsg','✅ Demo gửi tới '+phone,'green');
    },2000);
  };

  $('showPhone').onclick=()=>{
    const phone=$('phone').value.trim(); if(!phone){ setMsg('toolMsg','Nhập phone','red'); return; }
    alert('Số: '+phone); setMsg('toolMsg','Hiện số: '+phone,'green');
  };

  // Admin: load members
  function loadMembers(){
    const users=getUsers();
    $('membersArea').innerHTML='<table><tr><th>Name</th><th>Email</th><th>Status</th><th>Hành động</th></tr>'+
      users.map(u=>`<tr>
        <td>${u.name}</td><td>${u.email}</td>
        <td>${u.blocked?'<span style="color:red">Blocked</span>':'Active'}</td>
        <td>${u.role!=='admin'?'<button onclick="toggleBlock(\''+u.id+'\')">'+(u.blocked?'Bỏ chặn':'Chặn')+'</button>':''}</td>
      </tr>`).join('')+'</table>';
  }
  window.toggleBlock=function(id){
    let users=getUsers(); const u=users.find(x=>x.id===id);
    if(u){u.blocked=!u.blocked; saveUsers(users); loadMembers();}
  };
  $('refreshMembers').onclick=loadMembers;

  // Kiểm tra tự động mỗi giây khi đang mở Tool
  setInterval(()=>{
    if(!$('boxTool').classList.contains('hidden')){
      updateToolStatus();
    }
  },1000);
</script>
</body>
</html>